import{style as f,animate as g,transition as C,trigger as w}from"@angular/animations";import*as h from"@angular/common";import{isPlatformBrowser as b,DOCUMENT as y,CommonModule as k}from"@angular/common";import*as e from"@angular/core";import{forwardRef as x,EventEmitter as m,PLATFORM_ID as M}from"@angular/core";import{NG_VALUE_ACCESSOR as H}from"@angular/forms";import{DomHandler as u,ConnectedOverlayScrollHandler as V}from"primeng/dom";import{ZIndexUtils as v}from"primeng/utils";import*as p from"primeng/api";var S=["container"],D=["input"],T=["colorSelector"],L=["colorHandle"],E=["hue"],I=["hueHandle"],R=r=>({"p-disabled":r});function O(r,d){if(r&1){let t=e.ɵɵgetCurrentView();e.ɵɵelementStart(0,"input",4,5),e.ɵɵlistener("click",function(){e.ɵɵrestoreView(t);let o=e.ɵɵnextContext();return e.ɵɵresetView(o.onInputClick())})("keydown",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onInputKeydown(o))})("focus",function(){e.ɵɵrestoreView(t);let o=e.ɵɵnextContext();return e.ɵɵresetView(o.onInputFocus())}),e.ɵɵelementEnd()}if(r&2){let t=e.ɵɵnextContext();e.ɵɵstyleProp("background-color",t.inputBgColor),e.ɵɵproperty("ngClass",e.ɵɵpureFunction1(7,R,t.disabled))("disabled",t.disabled),e.ɵɵattribute("tabindex",t.tabindex)("id",t.inputId)("data-pc-section","input")}}var P=(r,d)=>({"p-colorpicker-panel":!0,"p-colorpicker-overlay-panel":r,"p-disabled":d}),B=(r,d)=>({showTransitionParams:r,hideTransitionParams:d}),A=r=>({value:"visible",params:r});function F(r,d){if(r&1){let t=e.ɵɵgetCurrentView();e.ɵɵelementStart(0,"div",6),e.ɵɵlistener("click",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onOverlayClick(o))})("@overlayAnimation.start",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onOverlayAnimationStart(o))})("@overlayAnimation.done",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onOverlayAnimationEnd(o))}),e.ɵɵelementStart(1,"div",7)(2,"div",8,9),e.ɵɵlistener("touchstart",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onColorDragStart(o))})("touchmove",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onDrag(o))})("touchend",function(){e.ɵɵrestoreView(t);let o=e.ɵɵnextContext();return e.ɵɵresetView(o.onDragEnd())})("mousedown",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onColorMousedown(o))}),e.ɵɵelementStart(4,"div",10),e.ɵɵelement(5,"div",11,12),e.ɵɵelementEnd()(),e.ɵɵelementStart(7,"div",13,14),e.ɵɵlistener("mousedown",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onHueMousedown(o))})("touchstart",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onHueDragStart(o))})("touchmove",function(o){e.ɵɵrestoreView(t);let n=e.ɵɵnextContext();return e.ɵɵresetView(n.onDrag(o))})("touchend",function(){e.ɵɵrestoreView(t);let o=e.ɵɵnextContext();return e.ɵɵresetView(o.onDragEnd())}),e.ɵɵelement(9,"div",15,16),e.ɵɵelementEnd()()()}if(r&2){let t=e.ɵɵnextContext();e.ɵɵproperty("ngClass",e.ɵɵpureFunction2(10,P,!t.inline,t.disabled))("@overlayAnimation",e.ɵɵpureFunction1(16,A,e.ɵɵpureFunction2(13,B,t.showTransitionOptions,t.hideTransitionOptions)))("@.disabled",t.inline===!0),e.ɵɵattribute("data-pc-section","panel"),e.ɵɵadvance(1),e.ɵɵattribute("data-pc-section","content"),e.ɵɵadvance(1),e.ɵɵattribute("data-pc-section","selector"),e.ɵɵadvance(2),e.ɵɵattribute("data-pc-section","color"),e.ɵɵadvance(1),e.ɵɵattribute("data-pc-section","colorHandle"),e.ɵɵadvance(2),e.ɵɵattribute("data-pc-section","hue"),e.ɵɵadvance(2),e.ɵɵattribute("data-pc-section","hueHandle")}}var X=(r,d)=>({"p-colorpicker p-component":!0,"p-colorpicker-overlay":r,"p-colorpicker-dragging":d}),z={provide:H,useExisting:x(()=>Q),multi:!0},Q=(()=>{class r{document;platformId;el;renderer;cd;config;overlayService;style;styleClass;inline;format="hex";appendTo;disabled;tabindex;inputId;autoZIndex=!0;baseZIndex=0;showTransitionOptions=".12s cubic-bezier(0, 0, 0.2, 1)";hideTransitionOptions=".1s linear";onChange=new m;onShow=new m;onHide=new m;containerViewChild;inputViewChild;value={h:0,s:100,b:100};inputBgColor;shown;overlayVisible;defaultColor="ff0000";onModelChange=()=>{};onModelTouched=()=>{};documentClickListener;documentResizeListener;documentMousemoveListener;documentMouseupListener;documentHueMoveListener;scrollHandler;selfClick;colorDragging;hueDragging;overlay;colorSelectorViewChild;colorHandleViewChild;hueViewChild;hueHandleViewChild;window;constructor(t,i,o,n,s,l,a){this.document=t,this.platformId=i,this.el=o,this.renderer=n,this.cd=s,this.config=l,this.overlayService=a,this.window=this.document.defaultView}set colorSelector(t){this.colorSelectorViewChild=t}set colorHandle(t){this.colorHandleViewChild=t}set hue(t){this.hueViewChild=t}set hueHandle(t){this.hueHandleViewChild=t}onHueMousedown(t){this.disabled||(this.bindDocumentMousemoveListener(),this.bindDocumentMouseupListener(),this.hueDragging=!0,this.pickHue(t))}onHueDragStart(t){this.disabled||(this.hueDragging=!0,this.pickHue(t,t.changedTouches[0]))}onColorDragStart(t){this.disabled||(this.colorDragging=!0,this.pickColor(t,t.changedTouches[0]))}pickHue(t,i){let o=i?i.pageY:t.pageY,n=this.hueViewChild?.nativeElement.getBoundingClientRect().top+(this.document.defaultView.pageYOffset||this.document.documentElement.scrollTop||this.document.body.scrollTop||0);this.value=this.validateHSB({h:Math.floor(360*(150-Math.max(0,Math.min(150,o-n)))/150),s:this.value.s,b:this.value.b}),this.updateColorSelector(),this.updateUI(),this.updateModel(),this.onChange.emit({originalEvent:t,value:this.getValueToUpdate()})}onColorMousedown(t){this.disabled||(this.bindDocumentMousemoveListener(),this.bindDocumentMouseupListener(),this.colorDragging=!0,this.pickColor(t))}onDrag(t){this.colorDragging&&(this.pickColor(t,t.changedTouches[0]),t.preventDefault()),this.hueDragging&&(this.pickHue(t,t.changedTouches[0]),t.preventDefault())}onDragEnd(){this.colorDragging=!1,this.hueDragging=!1,this.unbindDocumentMousemoveListener(),this.unbindDocumentMouseupListener()}pickColor(t,i){let o=i?i.pageX:t.pageX,n=i?i.pageY:t.pageY,s=this.colorSelectorViewChild?.nativeElement.getBoundingClientRect(),l=s.top+(this.document.defaultView.pageYOffset||this.document.documentElement.scrollTop||this.document.body.scrollTop||0),a=s.left+this.document.body.scrollLeft,c=Math.floor(100*Math.max(0,Math.min(150,o-a))/150),_=Math.floor(100*(150-Math.max(0,Math.min(150,n-l)))/150);this.value=this.validateHSB({h:this.value.h,s:c,b:_}),this.updateUI(),this.updateModel(),this.onChange.emit({originalEvent:t,value:this.getValueToUpdate()})}getValueToUpdate(){let t;switch(this.format){case"hex":t="#"+this.HSBtoHEX(this.value);break;case"rgb":t=this.HSBtoRGB(this.value);break;case"hsb":t=this.value;break}return t}updateModel(){this.onModelChange(this.getValueToUpdate())}writeValue(t){if(t)switch(this.format){case"hex":this.value=this.HEXtoHSB(t);break;case"rgb":this.value=this.RGBtoHSB(t);break;case"hsb":this.value=t;break}else this.value=this.HEXtoHSB(this.defaultColor);this.updateColorSelector(),this.updateUI(),this.cd.markForCheck()}updateColorSelector(){if(this.colorSelectorViewChild){let t={};t.s=100,t.b=100,t.h=this.value.h,this.colorSelectorViewChild.nativeElement.style.backgroundColor="#"+this.HSBtoHEX(t)}}updateUI(){this.colorHandleViewChild&&this.hueHandleViewChild?.nativeElement&&(this.colorHandleViewChild.nativeElement.style.left=Math.floor(150*this.value.s/100)+"px",this.colorHandleViewChild.nativeElement.style.top=Math.floor(150*(100-this.value.b)/100)+"px",this.hueHandleViewChild.nativeElement.style.top=Math.floor(150-150*this.value.h/360)+"px"),this.inputBgColor="#"+this.HSBtoHEX(this.value)}onInputFocus(){this.onModelTouched()}show(){this.overlayVisible=!0,this.cd.markForCheck()}onOverlayAnimationStart(t){switch(t.toState){case"visible":this.inline||(this.overlay=t.element,this.appendOverlay(),this.autoZIndex&&v.set("overlay",this.overlay,this.config.zIndex.overlay),this.alignOverlay(),this.bindDocumentClickListener(),this.bindDocumentResizeListener(),this.bindScrollListener(),this.updateColorSelector(),this.updateUI());break;case"void":this.onOverlayHide();break}}onOverlayAnimationEnd(t){switch(t.toState){case"visible":this.inline||this.onShow.emit({});break;case"void":this.autoZIndex&&v.clear(t.element),this.onHide.emit({});break}}appendOverlay(){this.appendTo&&(this.appendTo==="body"?this.renderer.appendChild(this.document.body,this.overlay):u.appendChild(this.overlay,this.appendTo))}restoreOverlayAppend(){this.overlay&&this.appendTo&&this.renderer.appendChild(this.el.nativeElement,this.overlay)}alignOverlay(){this.appendTo?u.absolutePosition(this.overlay,this.inputViewChild?.nativeElement):u.relativePosition(this.overlay,this.inputViewChild?.nativeElement)}hide(){this.overlayVisible=!1,this.cd.markForCheck()}onInputClick(){this.selfClick=!0,this.togglePanel()}togglePanel(){this.overlayVisible?this.hide():this.show()}onInputKeydown(t){switch(t.code){case"Space":this.togglePanel(),t.preventDefault();break;case"Escape":case"Tab":this.hide();break;default:break}}onOverlayClick(t){this.overlayService.add({originalEvent:t,target:this.el.nativeElement}),this.selfClick=!0}registerOnChange(t){this.onModelChange=t}registerOnTouched(t){this.onModelTouched=t}setDisabledState(t){this.disabled=t,this.cd.markForCheck()}bindDocumentClickListener(){if(!this.documentClickListener){let t=this.el?this.el.nativeElement.ownerDocument:"document";this.documentClickListener=this.renderer.listen(t,"click",()=>{this.selfClick||(this.overlayVisible=!1,this.unbindDocumentClickListener()),this.selfClick=!1,this.cd.markForCheck()})}}unbindDocumentClickListener(){this.documentClickListener&&(this.documentClickListener(),this.documentClickListener=null)}bindDocumentMousemoveListener(){if(!this.documentMousemoveListener){let t=this.el?this.el.nativeElement.ownerDocument:"document";this.documentMousemoveListener=this.renderer.listen(t,"mousemove",i=>{this.colorDragging&&this.pickColor(i),this.hueDragging&&this.pickHue(i)})}}unbindDocumentMousemoveListener(){this.documentMousemoveListener&&(this.documentMousemoveListener(),this.documentMousemoveListener=null)}bindDocumentMouseupListener(){if(!this.documentMouseupListener){let t=this.el?this.el.nativeElement.ownerDocument:"document";this.documentMouseupListener=this.renderer.listen(t,"mouseup",()=>{this.colorDragging=!1,this.hueDragging=!1,this.unbindDocumentMousemoveListener(),this.unbindDocumentMouseupListener()})}}unbindDocumentMouseupListener(){this.documentMouseupListener&&(this.documentMouseupListener(),this.documentMouseupListener=null)}bindDocumentResizeListener(){b(this.platformId)&&(this.documentResizeListener=this.renderer.listen(this.window,"resize",this.onWindowResize.bind(this)))}unbindDocumentResizeListener(){this.documentResizeListener&&(this.documentResizeListener(),this.documentResizeListener=null)}onWindowResize(){this.overlayVisible&&!u.isTouchDevice()&&this.hide()}bindScrollListener(){this.scrollHandler||(this.scrollHandler=new V(this.containerViewChild?.nativeElement,()=>{this.overlayVisible&&this.hide()})),this.scrollHandler.bindScrollListener()}unbindScrollListener(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()}validateHSB(t){return{h:Math.min(360,Math.max(0,t.h)),s:Math.min(100,Math.max(0,t.s)),b:Math.min(100,Math.max(0,t.b))}}validateRGB(t){return{r:Math.min(255,Math.max(0,t.r)),g:Math.min(255,Math.max(0,t.g)),b:Math.min(255,Math.max(0,t.b))}}validateHEX(t){var i=6-t.length;if(i>0){for(var o=[],n=0;n<i;n++)o.push("0");o.push(t),t=o.join("")}return t}HEXtoRGB(t){let i=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return{r:i>>16,g:(i&65280)>>8,b:i&255}}HEXtoHSB(t){return this.RGBtoHSB(this.HEXtoRGB(t))}RGBtoHSB(t){var i={h:0,s:0,b:0},o=Math.min(t.r,t.g,t.b),n=Math.max(t.r,t.g,t.b),s=n-o;return i.b=n,i.s=n!=0?255*s/n:0,i.s!=0?t.r==n?i.h=(t.g-t.b)/s:t.g==n?i.h=2+(t.b-t.r)/s:i.h=4+(t.r-t.g)/s:i.h=-1,i.h*=60,i.h<0&&(i.h+=360),i.s*=100/255,i.b*=100/255,i}HSBtoRGB(t){var i={r:0,g:0,b:0};let o=t.h,n=t.s*255/100,s=t.b*255/100;if(n==0)i={r:s,g:s,b:s};else{let l=s,a=(255-n)*s/255,c=(l-a)*(o%60)/60;o==360&&(o=0),o<60?(i.r=l,i.b=a,i.g=a+c):o<120?(i.g=l,i.b=a,i.r=l-c):o<180?(i.g=l,i.r=a,i.b=a+c):o<240?(i.b=l,i.r=a,i.g=l-c):o<300?(i.b=l,i.g=a,i.r=a+c):o<360?(i.r=l,i.g=a,i.b=l-c):(i.r=0,i.g=0,i.b=0)}return{r:Math.round(i.r),g:Math.round(i.g),b:Math.round(i.b)}}RGBtoHEX(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];for(var o in i)i[o].length==1&&(i[o]="0"+i[o]);return i.join("")}HSBtoHEX(t){return this.RGBtoHEX(this.HSBtoRGB(t))}onOverlayHide(){this.unbindScrollListener(),this.unbindDocumentResizeListener(),this.unbindDocumentClickListener(),this.overlay=null}ngOnDestroy(){this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.overlay&&this.autoZIndex&&v.clear(this.overlay),this.restoreOverlayAppend(),this.onOverlayHide()}static ɵfac=function(i){return new(i||r)(e.ɵɵdirectiveInject(y),e.ɵɵdirectiveInject(M),e.ɵɵdirectiveInject(e.ElementRef),e.ɵɵdirectiveInject(e.Renderer2),e.ɵɵdirectiveInject(e.ChangeDetectorRef),e.ɵɵdirectiveInject(p.PrimeNGConfig),e.ɵɵdirectiveInject(p.OverlayService))};static ɵcmp=e.ɵɵdefineComponent({type:r,selectors:[["p-colorPicker"]],viewQuery:function(i,o){if(i&1&&(e.ɵɵviewQuery(S,5),e.ɵɵviewQuery(D,5),e.ɵɵviewQuery(T,5),e.ɵɵviewQuery(L,5),e.ɵɵviewQuery(E,5),e.ɵɵviewQuery(I,5)),i&2){let n;e.ɵɵqueryRefresh(n=e.ɵɵloadQuery())&&(o.containerViewChild=n.first),e.ɵɵqueryRefresh(n=e.ɵɵloadQuery())&&(o.inputViewChild=n.first),e.ɵɵqueryRefresh(n=e.ɵɵloadQuery())&&(o.colorSelector=n.first),e.ɵɵqueryRefresh(n=e.ɵɵloadQuery())&&(o.colorHandle=n.first),e.ɵɵqueryRefresh(n=e.ɵɵloadQuery())&&(o.hue=n.first),e.ɵɵqueryRefresh(n=e.ɵɵloadQuery())&&(o.hueHandle=n.first)}},hostAttrs:[1,"p-element"],inputs:{style:"style",styleClass:"styleClass",inline:"inline",format:"format",appendTo:"appendTo",disabled:"disabled",tabindex:"tabindex",inputId:"inputId",autoZIndex:"autoZIndex",baseZIndex:"baseZIndex",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions"},outputs:{onChange:"onChange",onShow:"onShow",onHide:"onHide"},features:[e.ɵɵProvidersFeature([z])],decls:4,vars:11,consts:[[3,"ngStyle","ngClass"],["container",""],["type","text","class","p-colorpicker-preview p-inputtext","readonly","readonly",3,"ngClass","disabled","backgroundColor","click","keydown","focus",4,"ngIf"],[3,"ngClass","click",4,"ngIf"],["type","text","readonly","readonly",1,"p-colorpicker-preview","p-inputtext",3,"ngClass","disabled","click","keydown","focus"],["input",""],[3,"ngClass","click"],[1,"p-colorpicker-content"],[1,"p-colorpicker-color-selector",3,"touchstart","touchmove","touchend","mousedown"],["colorSelector",""],[1,"p-colorpicker-color"],[1,"p-colorpicker-color-handle"],["colorHandle",""],[1,"p-colorpicker-hue",3,"mousedown","touchstart","touchmove","touchend"],["hue",""],[1,"p-colorpicker-hue-handle"],["hueHandle",""]],template:function(i,o){i&1&&(e.ɵɵelementStart(0,"div",0,1),e.ɵɵtemplate(2,O,2,9,"input",2)(3,F,11,18,"div",3),e.ɵɵelementEnd()),i&2&&(e.ɵɵclassMap(o.styleClass),e.ɵɵproperty("ngStyle",o.style)("ngClass",e.ɵɵpureFunction2(8,X,!o.inline,o.colorDragging||o.hueDragging)),e.ɵɵattribute("data-pc-name","colorpicker")("data-pc-section","root"),e.ɵɵadvance(2),e.ɵɵproperty("ngIf",!o.inline),e.ɵɵadvance(1),e.ɵɵproperty("ngIf",o.inline||o.overlayVisible))},dependencies:[h.NgClass,h.NgIf,h.NgStyle],styles:[`@layer primeng{.p-colorpicker{display:inline-block}.p-colorpicker-dragging{cursor:pointer}.p-colorpicker-overlay{position:relative}.p-colorpicker-panel{position:relative;width:193px;height:166px}.p-colorpicker-overlay-panel{position:absolute;top:0;left:0}.p-colorpicker-preview{cursor:pointer}.p-colorpicker-panel .p-colorpicker-content{position:relative}.p-colorpicker-panel .p-colorpicker-color-selector{width:150px;height:150px;top:8px;left:8px;position:absolute}.p-colorpicker-panel .p-colorpicker-color{width:150px;height:150px}.p-colorpicker-panel .p-colorpicker-color-handle{position:absolute;top:0;left:150px;border-radius:100%;width:10px;height:10px;border-width:1px;border-style:solid;margin:-5px 0 0 -5px;cursor:pointer;opacity:.85}.p-colorpicker-panel .p-colorpicker-hue{width:17px;height:150px;top:8px;left:167px;position:absolute;opacity:.85}.p-colorpicker-panel .p-colorpicker-hue-handle{position:absolute;top:150px;left:0;width:21px;margin-left:-2px;margin-top:-5px;height:10px;border-width:2px;border-style:solid;opacity:.85;cursor:pointer}}
`],encapsulation:2,data:{animation:[w("overlayAnimation",[C(":enter",[f({opacity:0,transform:"scaleY(0.8)"}),g("{{showTransitionParams}}")]),C(":leave",[g("{{hideTransitionParams}}",f({opacity:0}))])])]},changeDetection:0})}return r})(),oe=(()=>{class r{static ɵfac=function(i){return new(i||r)};static ɵmod=e.ɵɵdefineNgModule({type:r});static ɵinj=e.ɵɵdefineInjector({imports:[k]})}return r})();export{z as COLORPICKER_VALUE_ACCESSOR,Q as ColorPicker,oe as ColorPickerModule};